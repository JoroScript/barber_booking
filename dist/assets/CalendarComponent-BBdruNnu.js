import{j as e,D as s,C as a}from"./vendor-date-Cb5cCYn7.js";import{r as t}from"./vendor-react-bRobaVKS.js";import{u as r,B as n}from"./app-context-CWzsb-TI.js";import{a as i}from"./vendor-api-7z2hFSF6.js";const l=[9,10,11,12,13,14,15,16,17],o=[{id:"miro",name:"Миро",experience:"6 месеца"},{id:"rado",name:"Радо",experience:"4 години"},{id:"simo",name:"Симо",experience:"2 години"}],c=[{id:"haircut",name:"Коса",duration:30,price:25},{id:"beard",name:"Брада",duration:20,price:15},{id:"combo",name:"Коса / Брада Kомбо",duration:45,price:35}],d=()=>{const{currentStep:a,selectedBarber:t,selectedService:n,date:i,time:l}=r(),d=e=>{var a,r;switch(e){case 1:return t?null==(a=o.find((e=>e.id===t)))?void 0:a.name:"Бръснар";case 2:return n?null==(r=c.find((e=>e.id===n)))?void 0:r.name:"Услуга";case 3:return i?s.fromJSDate(i).setZone("Europe/Sofia").toFormat("dd/MM/yyyy"):"Дата";case 4:return l?`${l}:00`:"Час";case 5:return"Данни";default:return""}};return e.jsx("div",{className:"step-indicator",children:e.jsxs("div",{className:"steps-wrapper",children:[[1,2,3,4,5].map((s=>e.jsxs("div",{className:`step ${s===a?"active":""} ${s<a?"completed":""}`,children:[e.jsx("div",{className:"step-number",children:s}),e.jsx("div",{className:"step-label",children:d(s)})]},s))),e.jsx("div",{className:"step-connector",children:e.jsx("div",{className:"step-connector-progress",style:{width:(a-1)/4*100+"%"}})})]})})},m=()=>{const{selectedBarber:s,setSelectedBarber:a,setCurrentStep:t}=r();return e.jsxs("div",{className:"barber-selection step-content",children:[e.jsx("h3",{children:"Избери Своя Бръснар"}),e.jsx("div",{className:"barbers-grid",children:o.map((r=>e.jsxs("div",{className:"barber-card "+(s===r.id?"selected":""),onClick:()=>{return e=r.id,a(e),void t(2);var e},children:[e.jsx("div",{className:"barber-avatar",children:r.name.charAt(0)}),e.jsxs("div",{className:"barber-info",children:[e.jsx("h4",{children:r.name}),e.jsx("div",{className:"barber-details",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Опит:"})," ",r.experience]})})]})]},r.id)))})]})},u=()=>{const{selectedService:s,setSelectedService:a,setCurrentStep:t}=r();return e.jsxs("div",{className:"service-selection step-content",children:[e.jsx("h3",{children:"Избери услуга"}),e.jsx("div",{className:"services-grid",children:c.map((r=>e.jsxs("div",{className:"service-card "+(s===r.id?"selected":""),onClick:()=>{return e=r.id,a(e),void t(3);var e},children:[e.jsx("h4",{children:r.name}),e.jsxs("div",{className:"service-details",children:[e.jsxs("p",{children:[r.duration," мин."]}),e.jsxs("p",{children:[r.price," лв."]})]})]},r.id)))})]})},h=i.create({baseURL:"http://localhost:5005/api",timeout:5e3,headers:{"Cache-Control":"max-age=300"}}),p=()=>{const{date:n,setDate:i,selectedBarber:o,setCurrentStep:c,fullyBookedDates:d,setFullyBookedDates:m,isMonthLoading:u,setIsMonthLoading:p,currentMonth:x,setCurrentMonth:b}=r(),[v,y]=t.useState({}),j=t.useCallback(((e,s)=>`${e.getFullYear()}-${e.getMonth()}-${s}`),[]),f=t.useCallback(((e,s)=>["Нд","Пн","Вт","Ср","Чт","Пт","Сб"][s.getDay()]),[]),N=t.useCallback(((e,s)=>`${["Януари","Февруари","Март","Април","Май","Юни","Юли","Август","Септември","Октомври","Ноември","Декември"][s.getMonth()]} ${s.getFullYear()}`),[]),g=t.useCallback(((e,a,t)=>{const r=new Map,n=l.length;for(let s=a;s<=t;s=s.plus({days:1})){const e=s.toFormat("yyyy-MM-dd");r.set(e,0)}return e.forEach((e=>{const a=s.fromISO(e.start).setZone("Europe/Sofia").toFormat("yyyy-MM-dd");r.has(a)&&r.set(a,r.get(a)+1)})),Array.from(r.entries()).filter((([e,s])=>s>=n)).map((([e])=>e))}),[]),S=t.useCallback((async()=>{if(!o)return;const e=j(x,o);if(v[e])return void m(v[e]);p(!0);const a=s.fromJSDate(x).startOf("month"),t=s.fromJSDate(x).endOf("month");try{const s=await(async(e,s,a)=>(await h.get("/get-month-events",{params:{startDate:e.toFormat("yyyy-MM-dd"),endDate:s.toFormat("yyyy-MM-dd"),barber:a}})).data.events)(a,t,o),r=g(s,a,t);y((s=>({...s,[e]:r}))),m(r)}catch(r){}finally{p(!1)}}),[o,x,g,m,p,v,j]);t.useEffect((()=>{if(!o)return void m([]);const e=setTimeout((()=>{S()}),300);return()=>clearTimeout(e)}),[o,x,S,m]);const k=t.useCallback((e=>{if(u)return;const a=s.fromJSDate(e).setZone("Europe/Sofia").toFormat("yyyy-MM-dd");d.includes(a)||(i(e),c(4))}),[u,d,i,c]),w=t.useCallback((({activeStartDate:e})=>{b(e)}),[b]),M=t.useCallback((({date:e})=>{const a=new Date;if(a.setHours(0,0,0,0),e<a)return!0;const t=s.fromJSDate(e).setZone("Europe/Sofia").toFormat("yyyy-MM-dd");return d.includes(t)}),[d]),C=t.useCallback((({date:e,view:a})=>{if("month"!==a)return"";const t=s.fromJSDate(e).setZone("Europe/Sofia").toFormat("yyyy-MM-dd");let r="";return d.includes(t)&&(r+="fully-booked-date"),n&&s.fromJSDate(n).hasSame(s.fromJSDate(e),"day")&&(r+=" selected-date-tile"),r}),[d,n]),D=t.useMemo((()=>e.jsx(a,{onChange:k,value:n,minDate:new Date,maxDate:(()=>{const e=new Date;return e.setDate(e.getDate()+42),e})(),tileDisabled:M,tileClassName:C,onActiveStartDateChange:w,className:"custom-calendar "+(u?"calendar-loading":""),showNeighboringMonth:!0,goToRangeStartOnSelect:!1,formatShortWeekday:f,formatMonthYear:N,locale:"bg-BG",prevLabel:"←",nextLabel:"→",prev2Label:"«",next2Label:"»"})),[n,k,M,C,w,u,f,N]);return e.jsxs("div",{className:"calendar-selection step-content",children:[e.jsx("h3",{children:"Избери Дата"}),e.jsx("div",{className:"calendar-wrapper",children:e.jsxs("div",{className:"calendar-container",children:[D,u&&e.jsx("div",{className:"calendar-loading-overlay",children:e.jsx("div",{className:"calendar-loading-spinner"})})]})})]})},x=()=>{const{date:a,time:n,setTime:i,selectedBarber:l,selectedService:o,setCurrentStep:c}=r(),[d,m]=t.useState([]),[u,p]=t.useState(!0);t.useEffect((()=>{}),[n]);const x=t.useMemo((()=>{const e=[];for(let s=9;s<=17;s++){const a=`${s.toString().padStart(2,"0")}:00`;e.push(a)}return e}),[]);t.useEffect((()=>{if(!a||!l||!o)return;p(!0);(async()=>{try{const e=await(async(e,a)=>{const t=s.fromJSDate(e).setZone("Europe/Sofia").toFormat("yyyy-MM-dd");return(await h.get("/get-events",{params:{date:t,barber:a}})).data.events})(a,l),t=e.map((e=>s.fromISO(e.start).setZone("Europe/Sofia").toFormat("HH:mm")));m(t)}catch(e){}finally{setTimeout((()=>{p(!1)}),600)}})()}),[a,l,o]);const b=t.useCallback((e=>!u&&!d.includes(e)),[d,u]),v=t.useCallback((e=>{if(u)return;const s=parseInt(e.split(":")[0],10);i(s),c(5)}),[u,i,c]);return e.jsxs("div",{className:"time-selection step-content",children:[e.jsx("h3",{children:"Избери Час"}),e.jsx("div",{className:"time-slots-container",children:e.jsx("div",{className:"time-slots",children:x.map((s=>{const a=b(s),t=parseInt(s.split(":")[0],10),r=n===t;return e.jsxs("button",{onClick:()=>a&&v(s),className:`time-button \n                  ${u?"loading":a?"available":"unavailable"} \n                  ${r?"selected":""}`,disabled:!a||u,children:[e.jsx("span",{className:"time-text",children:s}),u&&e.jsx("span",{className:"time-loading-indicator"})]},s)}))})}),e.jsxs("div",{style:{display:"none"},children:[e.jsxs("p",{children:["Selected time: ",n]}),e.jsxs("p",{children:["Time type: ",typeof n]})]})]})},b=()=>{const{customerInfo:a,setCustomerInfo:n,selectedBarber:i,selectedService:l,date:d,time:m,setModalMessage:u,setModalOpen:p,setAppointments:x,setBookingSummary:b,setBookingConfirmed:v}=r(),[y,j]=t.useState(!1);t.useEffect((()=>{}),[m]);const f=e=>{const{name:s,value:a}=e.target;n((e=>({...e,[s]:a})))};return e.jsxs("div",{className:"customer-info step-content",children:[e.jsx("h3",{children:"Вашата Информация"}),e.jsxs("form",{className:"customer-form "+(y?"submitting":""),onSubmit:async e=>{var t,r,n;if(e.preventDefault(),!i||!l||!d||null===m)return u("Please complete all booking information"),void p(!0);if(!a.name||!a.email||!a.phoneNumber)return u("Please fill in all customer information"),void p(!0);j(!0);const y=await(async(e,a,t,r)=>{var n,i;try{const n=s.fromJSDate(a).setZone("Europe/Sofia").toFormat("yyyy-MM-dd"),i=s.fromJSDate(a).setZone("Europe/Sofia").set({hour:t,minute:0}).toFormat("HH:mm:ss");return(await h.post("/check-availability",{barber:e,date:n,time:i,duration:r})).data}catch(l){return{available:!1,error:(null==(i=null==(n=l.response)?void 0:n.data)?void 0:i.error)||"Failed to check availability"}}})(i,d,m,c.find((e=>e.id===l)).duration);if(!y.available)return j(!1),u(y.error||"This time slot is no longer available"),void p(!0);const f=s.fromJSDate(d).setZone("Europe/Sofia"),N=f.toFormat("yyyy-MM-dd"),g=f.set({hour:m,minute:0}).toFormat("HH:mm:ss"),S=c.find((e=>e.id===l)),k=o.find((e=>e.id===i)),w={customerName:a.name,customerEmail:a.email,phoneNumber:a.phoneNumber,barber:i,barberName:k.name,service:l,date:N,time:g,duration:S.duration};try{const e=await(async e=>(await h.post("/booking",e)).data)(w);b({barberName:k.name,serviceName:S.name,date:N,time:`${m}:00`,duration:S.duration,price:S.price,customerName:a.name,customerEmail:a.email,customerPhone:a.phoneNumber,appointmentId:e.appointmentId}),v(!0);const s={id:e.appointmentId,summary:`${l} - ${a.name}`,start:f.set({hour:m,minute:0}).toISO(),end:f.set({hour:m,minute:S.duration}).toISO()};x((e=>[...e,s]))}catch(M){let e="Failed to book appointment";e=409===(null==(t=M.response)?void 0:t.status)?"This time slot has been booked by someone else. Please select another time.":(null==(n=null==(r=M.response)?void 0:r.data)?void 0:n.error)||e,u(e),p(!0)}finally{j(!1)}},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Име"}),e.jsx("input",{type:"text",id:"name",name:"name",value:a.name,onChange:f,required:!0,placeholder:"",disabled:y})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Имейл"}),e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:f,required:!0,placeholder:"",disabled:y})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phoneNumber",children:"Телефон"}),e.jsx("input",{type:"tel",id:"phoneNumber",name:"phoneNumber",value:a.phoneNumber,onChange:f,required:!0,placeholder:"",disabled:y})]}),e.jsx("button",{type:"submit",className:"submit-button "+(y?"submitting":""),disabled:!a.name||!a.email||!a.phoneNumber||y||null===m,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"button-spinner"}),"Processing..."]}):"Book Appointment"})]})]})},v=()=>{const{bookingSummary:a,resetBooking:t}=r();return a?e.jsxs("div",{className:"booking-confirmation",children:[e.jsxs("div",{className:"confirmation-header",children:[e.jsx("div",{className:"success-icon",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})}),e.jsx("h3",{children:"Успешно Запазен Час"})]}),e.jsxs("div",{className:"booking-summary",children:[e.jsx("h4",{children:"Данни за Услугата"}),e.jsxs("div",{className:"summary-details",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Бръснар:"}),e.jsx("span",{className:"summary-value",children:a.barberName})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Услуга:"}),e.jsx("span",{className:"summary-value",children:a.serviceName})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Дата:"}),e.jsx("span",{className:"summary-value",children:s.fromISO(a.date).toFormat("dd/MM/yyyy")})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Час:"}),e.jsx("span",{className:"summary-value",children:a.time})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Времетраене:"}),e.jsxs("span",{className:"summary-value",children:[a.duration," мин."]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Цена:"}),e.jsxs("span",{className:"summary-value",children:[a.price," лв."]})]})]})]}),e.jsxs("div",{className:"customer-details",children:[e.jsx("h4",{children:"Вашите Данни"}),e.jsxs("div",{className:"summary-details",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Име:"}),e.jsx("span",{className:"summary-value",children:a.customerName})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Email:"}),e.jsx("span",{className:"summary-value",children:a.customerEmail})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Телефон:"}),e.jsx("span",{className:"summary-value",children:a.customerPhone})]})]})]}),e.jsxs("div",{className:"email-notification",children:[e.jsx("div",{className:"email-icon",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"})})}),e.jsx("p",{children:'Изпратихме детайлите за вашата резервация на посочения имейл адрес. Моля, проверете и вашата папка "Спам", ако не виждате имейла.'})]}),e.jsx("div",{className:"confirmation-actions",children:e.jsx("button",{type:"button",className:"new-booking-button",onClick:t,children:"Резервирай Нов Час"})})]}):null},y=({isOpen:s,onClose:a,message:r})=>(t.useEffect((()=>(document.body.style.overflow=s?"hidden":"",()=>{document.body.style.overflow=""})),[s]),s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm z-40 animate-fadeIn"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:e.jsxs("div",{className:"max-w-md w-11/12 shadow-2xl overflow-hidden rounded-lg bg-gradient-to-br from-gray-900 to-black border border-red-800 animate-slideIn pointer-events-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-red-900 to-red-700 px-5 py-4 border-b border-red-800",children:e.jsx("h3",{className:"text-lg font-medium text-white",children:"Booking Unavailable"})}),e.jsx("div",{className:"px-5 py-6 text-gray-200",children:e.jsx("p",{children:r||"This time slot is no longer available. Please select another date and time."})}),e.jsx("div",{className:"px-5 py-4 bg-gradient-to-r from-gray-900 to-black border-t border-red-800 flex justify-end",children:e.jsx("button",{className:"bg-gradient-to-r from-red-700 to-red-600 hover:from-red-800 hover:to-red-700 text-white font-medium py-2 px-4 rounded transition duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50",onClick:a,children:"OK"})})]})})]}):null);if("undefined"!=typeof document){const e=document.createElement("style");e.type="text/css",e.innerText="\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n@keyframes slideIn {\n  from { transform: translateY(-20px); opacity: 0; }\n  to { transform: translateY(0); opacity: 1; }\n}\n\n.animate-fadeIn {\n  animation: fadeIn 0.3s ease-out;\n}\n\n.animate-slideIn {\n  animation: slideIn 0.4s ease-out;\n}\n",document.head.appendChild(e)}const j=()=>{const{currentStep:s,modalOpen:a,modalMessage:t,handleModalClose:n,bookingConfirmed:i,handleBackButton:l}=r();return e.jsxs("div",{className:"booking-container",children:[!i&&e.jsx("h2",{className:"booking-title",children:"Запази си Час"}),!i&&e.jsx(d,{}),e.jsxs("div",{className:"booking-content",children:[s>1&&!i&&e.jsx("button",{className:"back-button",onClick:l,children:"← Назад"}),e.jsx("div",{className:"steps-container",children:(()=>{switch(s){case 1:return e.jsx(m,{});case 2:return e.jsx(u,{});case 3:return e.jsx(p,{});case 4:return e.jsx(x,{});case 5:return i?e.jsx(v,{}):e.jsx(b,{});default:return null}})()})]}),e.jsx(y,{isOpen:a,onClose:n,message:t})]})},f=()=>e.jsx(n,{children:e.jsx(j,{})});export{f as default};
